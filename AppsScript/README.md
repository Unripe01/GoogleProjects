# mail2calendar_from_tol.js

gmailに届いたメールを解析し、Googleカレンダーに予定を自動登録します。
Google App Scriptのトリガーとして登録し実行させてください。
---
![image](https://user-images.githubusercontent.com/2908535/196748547-b61f114b-518f-4e11-9f2e-d2475b62fc69.png)
---
↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
---
![image](https://user-images.githubusercontent.com/2908535/196749177-fdb68b09-552f-46fc-949b-4c8d43553595.png)
---

## 想定しているメール本文
以下のようなメール文面が対象となります。

- 件名 
> [tol] 「パーソナルジム XXXXXXXXXXXXX」を予約しました
- 本文
> ○○○○ 様
>
> 「パーソナルジム XXXXXXXXXX」をご予約いただきありがとうございます。
> もしご都合が悪くなり、予約をキャンセルしたい場合、ショップへ直接ご連絡ください。
> 
> 予約はまだ確定ではありません。
> ショップ運営者に予約が承認されると、承認された旨のメールが届きます。
> 予約承認がされた時点で予約の確定となります。
> 
> ◆予約内容
> ショップ名：XXXXXXXXXX
> サービス名：パーソナルジム
> オプション：なし
> 予約日時：10月25日(火) 19:30~20:20
> 金額：30,000円
> お支払い方法：銀行振込
> 備考：

## 実装内容
1. Gmailの検索に使用する検索クエリと同一の検索条件でメールスレッドを抽出します。
2. クエリでは subject と label:inbox を条件に抽出しています。
3. 取得したスレッドを順次解析し、メール本文にある予約日時を抽出します。
4. 解析した予約日時でGoogleカレンダーにスケジュール登録します。
5. 同じスレッドを処理しないように、処理済のスレッドをアーカイブします。

最後にスレッドをアーカイブすることにより、label:inbox の条件から外れ、
次回のスクリプト実行時に対象外のスレッドとなります。
